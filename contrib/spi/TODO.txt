===============================================================================
Apache Jackrabbit SPI - TODOs
===============================================================================

NOTE: This list only contains major open issues.
      Minor known issues and problems are marked throughout the code with TODO.


1) RepositoryService  (missing)
   
   missing implementation for:
   > Clone
   > Copy between Workspaces
   > Impersonate
   > RegisterNodeType
   > ReregisterNodeTypes
   > UnregisterNodeType
   
   
2) RepositoryService  (improve)

   param consistency
   while in the very first draft ids, values and names were represented
   by String and Stream only, we currently have a inconsistent mixture
   of separate interfaces/classes for ids and names, while values are
   still represented by String/Stream only mentioning in the comments
   that values are meant to be in a qualified form in case of property
   type Name and Path.
   Second it seems inconsistent that an interface is defined for ItemId,
   while the QName class from jackrabbit commons is used (see also FAQ).


3) RepositoryService, Batch (improve)

   > check consistency of throw clauses.


4) Locking: Handling of LockTokens  (problem)

   There are 2 methods in JSR 170 that deal with handling of LockTokens:
   Session.addLockToken, Session.removeLockToken. The spec defines, that
    
   a) session-scoped locks may not be transfered to another session
   b) only one Session object must be lock holder. adding a token that is
      still present with another session is not possible.

   This causes the following issues with the SPI

   a) session-scoped locks are currently not implemented properly (see 5)
   b) no session info is transfered over the SPI boundary nor are the addLT/
      removeLT methods passed over the SPI.
      consequently its (with the current design) not possible to detect, whether
      the given locktoken is still hold by another Session object.


5) Observation (problem)

   - distinction between local and external modifications
   - proper order of events
   - assertion that the same event doesn't get processed multiple times

   - EventImpl: with the current setup spi2dav connects to a default 
     jackrabbit jcr-server reflecting JCR calls. consequently event discovery
     will only return JCR events.
     Additional information defined by the SPI Event interface cannot be 
     retrieved from the information sent by jcr-server.


6) AddNode (problem)
 
   In order to be able to return the created Node, it would be required to
   now its Id if the operation succeeded, since the Node name passed to the
   call may not identify the new Node in case of same-name-siblings.


7) Merge (problem)
   
   similar to 8)
   The call defines a NodeIterator as return value.
   
   In addition: fallback required if Observation is not supported feature.
   


8) Transactions (work in progress)

   Definition of XASessionInfo must be reviewed.


9) Extract interface for ItemState and derived classes


10) AccessManager.canRead() seems useless, since the jcr2spi client is only
    able to access Items it can read anyway. Remove method and calls to it?


11) Nodetypes, Namespaces (improve)
    
    Should the SPI define means for observation of nodetype/namespace
    changes? 


12) LockManager currently relies on Observation in order to detect
    if a lock gets released by someone else.
    => that needs to be fixed.


