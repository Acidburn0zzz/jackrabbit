<?xml version="1.0" encoding="UTF-8"?>
<!--
	Licensed to the Apache Software Foundation (ASF) under one or more
	contributor license agreements.  See the NOTICE file distributed with
	this work for additional information regarding copyright ownership.
	The ASF licenses this file to You under the Apache License, Version 2.0
	(the "License"); you may not use this file except in compliance with
	the License.  You may obtain a copy of the License at
	
	http://www.apache.org/licenses/LICENSE-2.0
	
	Unless required by applicable law or agreed to in writing, software
	distributed under the License is distributed on an "AS IS" BASIS,
	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	See the License for the specific language governing permissions and
	limitations under the License.
-->
<!DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd">
<web-app>
	
	<display-name>Jackrabbit JCR Browser</display-name>

	<!-- ====================================================================== -->
	<!-- F I L T E R                                                            -->
	<!-- ====================================================================== -->

	<filter>
		<filter-name>loginFilter</filter-name>
		<filter-class>org.apache.jackrabbit.browser.JcrLoginFilter</filter-class>
	</filter>
	
	<filter>
		<filter-name>iframeIOFilter</filter-name>
		<filter-class>org.apache.jackrabbit.browser.iframeio.IFrameIOFilter</filter-class>
	</filter>	

	<filter-mapping>
		<filter-name>loginFilter</filter-name>
		<url-pattern>/browser/*</url-pattern>
	</filter-mapping>

	<filter-mapping>
		<filter-name>iframeIOFilter</filter-name>
		<url-pattern>*.iframe</url-pattern>
	</filter-mapping>
	
	<!-- ====================================================================== -->
	<!-- L I S T E N E R                                                        -->
	<!-- ====================================================================== -->
	<listener>
		<listener-class>org.apache.jackrabbit.browser.JcrSessionListener</listener-class>
	</listener>

    <!-- ====================================================================== -->
    <!-- L O G G I N G   S E R V L E T                                          -->
    <!-- ====================================================================== -->
    <servlet>
        <servlet-name>Logging</servlet-name>
        <description>The logging servlet configures the Log4J logging facility.</description>
        <servlet-class>org.apache.jackrabbit.j2ee.LoggingServlet</servlet-class>

        <init-param>
            <param-name>log4j-config</param-name>
            <param-value>/WEB-INF/log4j.xml</param-value>
            <description>initial log4j configuration</description>
        </init-param>

        <load-on-startup>1</load-on-startup>
    </servlet>

    <!-- ====================================================================== -->
    <!-- R E P O S I T O R Y   S T A R T U P  S E R V L E T                     -->
    <!-- ====================================================================== -->
    <servlet>
        <servlet-name>RepositoryStartup</servlet-name>
        <description>
            Repository servlet that starts the repository and registers it to JNDI ans RMI.
            If you already have the repository registered in this appservers JNDI context,
            or if its accessible via RMI, you do not need to use this servlet.
        </description>
        <servlet-class>org.apache.jackrabbit.j2ee.RepositoryStartupServlet</servlet-class>

        <init-param>
            <param-name>repository-config</param-name>
            <param-value>/WEB-INF/repository.xml</param-value>
            <description>the repository config location</description>
        </init-param>

        <init-param>
            <param-name>repository-home</param-name>
            <param-value>jackrabbit/repository</param-value>
            <description>the repository home</description>
        </init-param>

        <init-param>
            <param-name>repository-name</param-name>
            <param-value>jackrabbit.repository</param-value>
            <description>Repository Name under which the repository is registered via JNDI/RMI</description>
        </init-param>

        <!--
            the following 3 parameters deal with registering the repository to
            a RMI registry. if all parameters are omitted, the repository will
            not be registered.
        -->
        <init-param>
            <param-name>rmi-port</param-name>
            <param-value>0</param-value>
            <description>
                The RMI port for registering the repository in the RMI Registry.
                If equals 0, the default port is used.
            </description>
        </init-param>
        <init-param>
            <param-name>rmi-host</param-name>
            <param-value>localhost</param-value>
            <description>
                The RMI host for registering the repository in the RMI Registry.
                If equals "" or missing, the default host is used.
            </description>
        </init-param>
        <init-param>
            <param-name>rmi-uri</param-name>
            <param-value></param-value>
            <description>
                The RMI uri for registering the repository in the RMI Registry.
                If missing, the uri is composed using the other rmi parameters
                and will have the format: //{rmi-host}:{rmi-port}/{repository-name}
            </description>
        </init-param>

        <!--
            JNDI environment variables for creating the initial context
            (all init parameters starting with java.naming.* will be added to the initial context environment).
        -->
        <init-param>
            <param-name>java.naming.provider.url</param-name>
            <param-value>http://www.apache.org/jackrabbit</param-value>
        </init-param>
        <!--
        <init-param>
            <param-name>java.naming.factory.initial</param-name>
            <param-value>org.apache.jackrabbit.core.jndi.provider.DummyInitialContextFactory</param-value>
        </init-param>
        -->
        
        <load-on-startup>2</load-on-startup>
    </servlet>
        
	<!-- ====================================================================== -->
	<!-- R E P O S I T O R Y   S E R V L E T                                    -->
	<!-- ====================================================================== -->
	<servlet>
		<servlet-name>Repository</servlet-name>
		<description>
			This servlet provides other servlets and jsps a common way
			to access the repository. The repository can be accessed via
			JNDI, RMI or Webdav.
		</description>
		<servlet-class>
			org.apache.jackrabbit.j2ee.RepositoryAccessServlet
		</servlet-class>
		<init-param>
			<param-name>repository-name</param-name>
			<param-value>jackrabbit.repository</param-value>
			<description>
				Repository Name that is used to retrieve it via JNDI
			</description>
		</init-param>
		<load-on-startup>3</load-on-startup>
	</servlet>

	<!-- ====================================================================== -->
	<!-- C O M M A N D S  S E R V L E T                                         -->
	<!-- ====================================================================== -->
	<servlet>
		<servlet-name>JCR commands</servlet-name>
		<description>JCR command servlet</description>
		<servlet-class>
			org.apache.jackrabbit.command.web.JcrCommandServlet
		</servlet-class>
		<init-param>
			<param-name>jndi.properties</param-name>
			<param-value>
			</param-value>
		</init-param>
		<init-param>
			<param-name>jndi.address</param-name>
			<param-value>jackrabbit.repository</param-value>
		</init-param>
		<init-param>
			<param-name>catalog</param-name>
			<param-value>
				/org/apache/jackrabbit/browser/commands.xml
			</param-value>
		</init-param>
		<init-param>
			<param-name>user</param-name>
			<param-value>admin</param-value>
		</init-param>
		<init-param>
			<param-name>password</param-name>
			<param-value>admin</param-value>
		</init-param>
		<init-param>
			<param-name>print.success</param-name>
			<param-value>true</param-value>
		</init-param>
		<init-param>
			<param-name>success.message.key</param-name>
			<param-value>success.message</param-value>
		</init-param>
		<init-param>
			<param-name>auto.save</param-name>
			<param-value>false</param-value>
		</init-param>					
		<init-param>
			<param-name>session.key</param-name>
			<param-value>jcr.session</param-value>
		</init-param>	
		<load-on-startup>6</load-on-startup>
	</servlet>

	<!-- ====================================================================== -->
	<!-- S E R V L E T   M A P P I N G                                          -->
	<!-- ====================================================================== -->
	<servlet-mapping>
		<servlet-name>JCR commands</servlet-name>
		<url-pattern>/command/*</url-pattern>
	</servlet-mapping>

	<!-- ====================================================================== -->
	<!-- T A G L I B S                                                          -->
	<!-- ====================================================================== -->
	<taglib>
		<taglib-uri>http://jakarta.apache.org/taglib/string</taglib-uri>
		<taglib-location>/WEB-INF/tld/string-1.1.0.tld</taglib-location>
	</taglib>
	<taglib>
		<taglib-uri>http://java.sun.com/jstl/core</taglib-uri>
		<taglib-location>/WEB-INF/tld/c.tld</taglib-location>
	</taglib>
	<taglib>
		<taglib-uri>http://jackrabbit.apache.org/jcr-taglib</taglib-uri>
		<taglib-location>/WEB-INF/tld/jcr.tld</taglib-location>
	</taglib>	

	<!-- ====================================================================== -->
	<!-- J C R  T A G L I B   C O N F I G                                       -->
	<!-- ====================================================================== -->
	<env-entry>
		<env-entry-name>jcr/beanFactory</env-entry-name>
		<env-entry-value>
			org.apache.jackrabbit.taglib.bean.SimpleBeanFactory
		</env-entry-value>
		<env-entry-type>java.lang.String</env-entry-type>
	</env-entry>
	<env-entry>
		<env-entry-name>jcr/jndi/properties</env-entry-name>
		<env-entry-value>
			i=i
		</env-entry-value>
		<env-entry-type>java.lang.String</env-entry-type>
	</env-entry>
	<env-entry>
		<env-entry-name>jcr/jndi/address</env-entry-name>
		<env-entry-value>jackrabbit.repository</env-entry-value>
		<env-entry-type>java.lang.String</env-entry-type>
	</env-entry>
	<!--  Traverser -->
	<env-entry>
		<env-entry-name>jcr/traverser/default</env-entry-name>
		<env-entry-value>
			org.apache.jackrabbit.taglib.traverser.PreorderTraverser
		</env-entry-value>
		<env-entry-type>java.lang.String</env-entry-type>
	</env-entry>
	<!--  Filter -->
	<env-entry>
		<env-entry-name>jcr/filter/default</env-entry-name>
		<env-entry-value>
			org.apache.jackrabbit.taglib.filter.JEXLItemFilter
		</env-entry-value>
		<env-entry-type>java.lang.String</env-entry-type>
	</env-entry>
	<!--  Comparator -->
	<env-entry>
		<env-entry-name>jcr/comparator/default</env-entry-name>
		<env-entry-value>
			org.apache.jackrabbit.taglib.comparator.JEXLItemComparator
		</env-entry-value>
		<env-entry-type>java.lang.String</env-entry-type>
	</env-entry>
	<!--  Template Engine -->
	<env-entry>
		<env-entry-name>jcr/template/engine/default</env-entry-name>
		<env-entry-value>
			org.apache.jackrabbit.taglib.template.SimpleTemplateEngine
		</env-entry-value>
		<env-entry-type>java.lang.String</env-entry-type>
	</env-entry>
	<!--  Size calculator -->
	<env-entry>
		<env-entry-name>jcr/size/default</env-entry-name>
		<env-entry-value>
			org.apache.jackrabbit.taglib.size.SimpleSizeCalculator
		</env-entry-value>
		<env-entry-type>java.lang.String</env-entry-type>
	</env-entry>
	<!--  Anonymous login -->
	<env-entry>
		<env-entry-name>jcr/login/anonuser</env-entry-name>
		<env-entry-value>anonymous</env-entry-value>
		<env-entry-type>java.lang.String</env-entry-type>
	</env-entry>
	<env-entry>
		<env-entry-name>jcr/login/anonpwd</env-entry-name>
		<env-entry-value />
		<env-entry-type>java.lang.String</env-entry-type>
	</env-entry>
	
	
	<!-- ====================================================================== -->
	<!-- L O G I N                                                              -->
	<!-- ====================================================================== -->
	
	<security-constraint>
	  <web-resource-collection>
	    <web-resource-name>
	      Entire Application
	    </web-resource-name>
	    <url-pattern>/browser/*</url-pattern>
	  </web-resource-collection>
	  <auth-constraint>
	      <role-name>user</role-name>
	  </auth-constraint>
	</security-constraint>
	
	<login-config>
		<auth-method>FORM</auth-method>
		<form-login-config>
			<form-login-page>/login.jsp</form-login-page>
			<form-error-page>/fail_login.html</form-error-page>
		</form-login-config>
	</login-config>

</web-app>
