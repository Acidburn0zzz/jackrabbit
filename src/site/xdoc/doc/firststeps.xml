<?xml version="1.0"?>
<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
  -->
<document>
  <properties>
    <title>First Hops</title>
  </properties>
  <body>
    <section name="First Hops with Jackrabbit">
      <p>
        Welcome to your first hops into the world of Jackrabbit! This
        introduction gives you a hands-on experience with Jackrabbit and
        the JCR API. Once you have finished hopping through this document,
        you should be all set to continue on your own with the official
        <a href="http://jcp.org/aboutJava/communityprocess/final/jsr170/index.html"
           class="externalLink"
           title="JSR-170: Content Repository for Java(TM) technology API"
           >JCR specification</a> and the
        <a href="index.html">documentation</a> on this site.
      </p>

      <subsection name="Hop 0: Getting started">
        <p>
          Before you can start using Jackrabbit, you need to have it installed
          on your computer. You can do this either by
          <a href="../downloads.cgi">downloading a binary release</a> and
          all the required
          <a href="../dependencies.html">dependencies</a> or by
          <a href="building.html">building the Jackrabbit sources</a>.
        </p>
        <p>
          Once you have Jackrabbit available locally, you should make sure
          that you have at least version 1.4 of the
          <a href="http://java.sun.com/j2se/" class="externalLink"
             >Java 2 Platform, Standard Edition</a> (J2SE) installed and the
          following libraries configured in your Java classpath:
        </p>
        <dl>
          <dt><a href="http://www.ibiblio.org/maven/org.apache.jackrabbit/jars/jackrabbit-core-1.0.jar" class="externalLink">jackrabbit-1.0.jar</a></dt>
          <dd>
            depending on whether you use a binary release or a locally
            compiled version,
          </dd>

          <dt><a href="http://www.day.com/maven/jsr170/jars/jcr-1.0.jar" class="externalLink">jcr-1.0.jar</a></dt>
          <dd>for the JCR 1.0 API,</dd>

          <dt><a href="http://www.ibiblio.org/maven/org.slf4j/jars/slf4j-log4j12-1.0.jar" class="externalLink">slf4j-log4j12-1.0.jar</a></dt>
          <dt><a href="http://www.ibiblio.org/maven/log4j/jars/log4j-1.2.8.jar" class="externalLink">log4j-1.2.8.jar</a></dt>
          <dd>
            for logging using
            <a href="http://www.slf4j.org/" class="externalLink"
               title="Simple Logging Facade for Java">SLF4J</a> with
            <a href="http://logging.apache.org/log4j/" class="externalLink"
               >Log4J</a> (you should be fine with any Log4J 1.2.x version,
            or you could even replace both of these jars with another SLF4J
            implementation),
          </dd>

          <dt><a href="http://www.ibiblio.org/maven/commons-collections/jars/commons-collections-3.1.jar" class="externalLink">commons-collections-3.1.jar</a></dt>
          <dd>for advanced data structures used by Jackrabbit,</dd>

          <dt><a href="http://www.ibiblio.org/maven/xerces/jars/xercesImpl-2.6.2.jar" class="externalLink">xercesImpl-2.6.2.jar</a></dt>
          <dt><a href="http://www.ibiblio.org/maven/xerces/jars/xmlParserAPIs-2.0.2.jar" class="externalLink">xmlParserApis-2.0.2.jar</a></dt>
          <dd>
            for advanced XML support (you should be fine with any recent
            <a href="http://xerces.apache.org/xerces2-j/"
               class="externalLink">Xerces2 Java Parser</a> implementation
            and the extra XML API library is only needed for JDK 1.4),
          </dd>

          <dt><a href="http://www.ibiblio.org/maven/org.apache.derby/jars/derby-10.1.3.1.jar" class="externalLink">derby-10.1.3.1.jar</a></dt>
          <dd>
            or any recent
            <a href="http://db.apache.org/derby/" class="externalLink"
               >Derby</a> release for embedded database storage,
          </dd>

          <dt><a href="http://www.ibiblio.org/maven/concurrent/jars/concurrent-1.3.4.jar" class="externalLink">concurrent-1.3.4.jar</a></dt>
          <dd>for advanced thread synchronization, and</dd>

          <dt><a href="http://www.ibiblio.org/maven/lucene/jars/lucene-1.4.3.jar" class="externalLink">lucene-1.4.3.jar</a></dt>
          <dd>for full text indexing and searching.</dd>
        </dl>
        <p>
          You should also add the current directory in your classpath to make
          it easy to compile and run the example classes. You may also want
          to copy the following
          <a href="hops/log4j.properties">log4j.properties</a> file to the
          current directory to avoid warnings of missing log configuration.
          If you want to see the internal Jackrabbit log, just change the
          log level to <code>INFO</code> or even <code>DEBUG</code>.
        </p>
<source>log4j.logger.org.apache.jackrabbit=WARN,stdout
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.SimpleLayout
</source>
        <p>
          HINT: If you have build Jackrabbit from sources with
          <a href="http://maven.apache.org/maven-1.x/" class="externalLink"
             >Maven 1.x</a>, you can get all the runtime dependencies (and some
          extra libraries) copied to <code>target/lib</code> by running
          <code>maven copy-deps</code> in the Jackrabbit project directory.
        </p>
        <p>
          HINT: You probably have an error in your classpath if you get a
          <code>ClassNotFoundException</code> message when trying to compile
          or run the examples below.
        </p>
      </subsection>

      <subsection name="Hop 1: Logging in to Jackrabbit">
        <p>
          Once you are done with the setup tasks, we can start doing some
          real work. As a warm-up we'll create a Jackrabbit content
          repository and start a login session for accessing it. The full
          example application that does this is shown below, with line-by-line
          explanations following shortly after.
        </p>
        <p><strong>FirstHop.java</strong></p>
<source><strong>import</strong> javax.jcr.Repository;
<strong>import</strong> javax.jcr.Session;
<strong>import</strong> org.apache.jackrabbit.core.TransientRepository;

/**
 * <em>First hop example. Logs in to a content repository and prints a</em>
 * <em>status message.</em>
 */
<strong>public class</strong> FirstHop {

    /**
     * <em>The main entry point of the example application.</em>
     *
     * @param args <em>command line arguments (ignored)</em>
     * @throws Exception <em>if an error occurs</em>
     */
    <strong>public static void</strong> main(String[] args) <strong>throws</strong> Exception {
        Repository repository = <strong>new</strong> TransientRepository();
        Session session = repository.login();
        <strong>try</strong> {
            String user = session.getUserID();
            String name = repository.getDescriptor(Repository.REP_NAME_DESC);
            System.out.println(
                    "<em>Logged in as </em>" + user + "<em> to a </em>" + name + "<em> repository.</em>");
        } <strong>finally</strong> {
            session.logout();
        }
    }

}</source>
        <p>
          You can also download the source file as
          <a href="hops/FirstHop.java">FirstHop.java</a>. If you have your
          classpath set up, you can compile the application with
          <code>javac FirstHop.java</code> and run it with
          <code>java FirstHop</code> to get the following output.
        </p>
        <source>Logged in as anonymous to a Jackrabbit repository.</source>
        <p>
          In addition to producing the above status line the application
          copies a default repository configuration file to
          <code>repository.xml</code> and creates an initial Jackrabbit
          content repository in the <code>repository</code> subdirectory.
          You can use the system properties
          <code>org.apache.jackrabbit.repository.conf</code> and
          <code>org.apache.jackrabbit.repository.home</code> to set alternative
          configuration file and repository directory locations.
        </p>
        <p>
          Read on for a detailed breakdown of the FirstHop application:
        </p>
        <dl>
          <dt><code><strong>import</strong> javax.jcr.Repository;</code></dt>
          <dt><code><strong>import</strong> javax.jcr.Session;</code></dt>
          <dd>
            <p>
              The JCR API interfaces are located in the <code>javax.jcr</code>
              package found in the <code>jcr-1.0.jar</code> library. The
              promise of the JCR API is that if you only use these interfaces
              in your content application, it should remain mostly independent
              of the underlying content repository implementation.
            </p>
            <p>
              The
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Repository.html"
                 class="externalLink" title="javax.jcr.Repository"
                 >Repository</a> interface represents a given content repository
              instance and the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Session.html"
                 class="externalLink" title="javax.jcr.Session"
                 >Session</a> interface represents a single login session for
              accessing the repository. A session is needed to access any
              content within a repository.
            </p>
            <p>
              Note that a Session instance is not guaranteed to be thread-safe
              so you should start multiple sessions if you need to access
              repository content simultaneously from different threads. This
              is especially important for things like web applications.
            </p>
          </dd>
          
          <dt><code><strong>import</strong> org.apache.jackrabbit.core.TransientRepository;</code></dt>
          <dd>
            <p>
              The best practice for deploying Jackrabbit is to use
              <a href="http://java.sun.com/products/jndi/" class="externalLink"
                 title="Java Naming and Directory Interface">JNDI</a> or some
              other configuration mechanism in a container environment to keep
              the application code free of direct Jackrabbit dependencies, but
              since we are creating a simple standalone application we can take
              a shortcut by using the
              <a href="../api-1/org/apache/jackrabbit/core/TransientRepository.html"
                 title="org.apache.jackrabbit.core.TransientRepository"
                 >TransientRepository</a> class from Jackrabbit core.
            </p>
          </dd>

          <dt><code><strong>public class</strong> FirstHop</code></dt>
          <dt><code><strong>public static void</strong> main(String[] args) <strong>throws</strong> Exception</code></dt>
          <dd>
            <p>
              The FirstHop example is a simple standalone application that fits
              nicely in the main() method and lets the JVM take care of the
              possible exceptions. More substantial content applications could
              also be written as web application or EJB components with
              different setup and error handling patterns.
            </p>
          </dd>

          <dt><code>Repository repository = <strong>new</strong> TransientRepository();</code></dt>
          <dd>
            <p>
              The
              <a href="../api-1/org/apache/jackrabbit/core/TransientRepository.html"
                 title="org.apache.jackrabbit.core.TransientRepository"
                 >TransientRepository</a> class implements the JCR
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Repository.html"
                 class="externalLink" title="javax.jcr.Repository"
                 >Repository</a> interface, so you can simply assign a
              TransientRepository instance to a Repository variable.
              The
              <a href="../api-1/org/apache/jackrabbit/core/TransientRepository.html#TransientRepository()"
                 title="TransientRepository()">default constructor</a>
              contains a utility feature that will take care of the initial
              configuration and repository construction when the first session
              is started. Thus there is no need for
              <a href="config.html">manual configuration</a> for now unless
              you want direct control over the repository setup.
            </p>
            <p>
              The TransientRepository implementation will automatically
              initialize the content repository when the first session is
              started and shut it down when the last session is closed. Thus
              there is no need for explicit repository shutdown as long as
              all sessions are properly closed. Note that a Jackrabbit
              repository directory contains a lock file that prevents it from
              being accessed simultaneously by multiple processes. You will
              see repository startup exceptions caused by the lock file if you
              fail to properly close all sessions or otherwise shut down the
              repository before leaving the process that accesses a repository.
              Normally you can just manually remove the lock file in such cases
              but such cases always present a chance of repository corruption
              especially if you use a non-transactional persistence manager.
            </p>
          </dd>

          <dt><code>Session session = repository.login();</code></dt>
          <dd>
            <p>
              The default
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Repository.html#login()"
                 class="externalLink">Repository.login()</a> method starts
              a repository session using the default workspace and no user
              credentials. Jackrabbit tries to use the
              <a href="http://java.sun.com/products/jaas/" class="externalLink"
                 >Java Authentication and Authorization Service</a> (JAAS)
              configuration in such cases, but defaults to the anonymous user
              if a JAAS Subject is not found.
            </p>
            <p>
              Since we use the TransientRepository class as the Repository
              implementation, this step will also cause the repository
              to be initialized.
            </p>
          </dd>

          <dt><code><strong>try</strong> { ... } <strong>finally</strong> { session.logout(); }</code></dt>
          <dd>
            <p>
              It is a good practice to properly release all acquired resources,
              and the JCR sessions are no exception. The try-finally idiom is
              a good way to ensure that a resource really gets released, as
              the release method gets called even if the intervening code
              throws an exception or otherwise jumps outside the scope (for
              example using a <code>return</code>, <code>break</code>, or
              <code>continue</code> statement).
            </p>
            <p>
              The
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Session.html#logout()"
                 class="externalLink">Session.logout()</a> method in the
              <code>finally</code> branch closes the session and since this
              is the only session we have started, the TransientRepository is
              automatically shut down.
            </p>
          </dd>

          <dt><code>String user = session.getUserID();</code></dt>
          <dd>
            <p>
              The username or identifier of the user associated with a session
              is available using the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Session.html#getUserID()"
                 class="externalLink">Session.getUserID()</a> method.
              Jackrabbit returns "anonymous" by default.
            </p>
          </dd>

          <dt><code>String name = repository.getDescriptor(Repository.REP_NAME_DESC);</code></dt>
          <dd>
            <p>
              Each content repository implementation publishes a number of
              string descriptors that describe the various implementation
              properties, like the implementation level and the supported
              optional JCR features. See the 
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Repository.html"
                 class="externalLink">Repository</a> interface for a list of
              the standard repository descriptors. The <code>REP_NAME_DESC</code>
              descriptor contains the name of the repository implementation,
              in this case "Jackrabbit".
            </p>
          </dd>
        </dl>
      </subsection>
      <subsection name="Hop 2: Working with content">
        <p>
          The main function of a content repository is allow applications
          to store and retrieve content. The <em>content</em> in a JCR content
          repository consists of structured or unstructured data modeled as
          a hierarchy of nodes with properties that contain the actual data.
        </p>
        <p>
          The following example application first stores some content to the
          initially empty content repository, then retrieves the stored content
          and outputs it, and finally removes the stored content.
        </p>
        <p><strong>SecondHop.java</strong></p>
<source><strong>import</strong> javax.jcr.Repository;
<strong>import</strong> javax.jcr.Session;
<strong>import</strong> javax.jcr.SimpleCredentials;
<strong>import</strong> javax.jcr.Node;
<strong>import</strong> org.apache.jackrabbit.core.TransientRepository;

/**
 * <em>Second hop example. Stores, retrieves, and removes example content.</em>
 */
<strong>public class</strong> SecondHop {

    /**
     * <em>The main entry point of the example application.</em>
     *
     * @param args <em>command line arguments (ignored)</em>
     * @throws Exception <em>if an error occurs</em>
     */
    <strong>public static void</strong> main(String[] args) <strong>throws</strong> Exception {
        Repository repository = <strong>new</strong> TransientRepository();
        Session session = repository.login(
                <strong>new</strong> SimpleCredentials("<em>username</em>", "<em>password</em>".toCharArray()));
        <strong>try</strong> {
            Node root = session.getRootNode();

            // <em>Store content</em>
            Node hello = root.addNode("hello");
            Node world = hello.addNode("world");
            world.setProperty("message", "Hello, World!");
            session.save();

            // <em>Retrieve content</em>
            Node node = root.getNode("hello/world");
            System.out.println(node.getPath());
            System.out.println(node.getProperty("message").getString());

            // <em>Remove content</em>
            root.getNode("hello").remove();
            session.save();
        } <strong>finally</strong> {
            session.logout();
        }
    }

}</source>
        <p>
          Like in the first hop, this example source is also available as
          <a href="hops/SecondHop.java">SecondHop.java</a>. You can also
          compile and run this class just like you did in the first hop
          example. Running this example should produce the following output:
        </p>
        <source>/hello/world
Hello, World!</source>
        <p>
          The basic structure of this example application is the same as
          in the First Hop example, so let's just walk through the
          differences:
        </p>
        <dl>
          <dt><code><strong>import</strong> javax.jcr.SimpleCredentials;</code></dt>
          <dt><code><strong>import</strong> javax.jcr.Node;</code></dt>
          <dd>
            <p>
              These are two new classes we need for this example. The
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/SimpleCredentials.html"
                 class="externalLink" title="javax.jcr.SimpleCredentials"
                >SimpleCredentials</a> class is a simple implementation of the 
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Credentials.html"
                 class="externalLink" title="javax.jcr.Credentials"
                >Credentials</a> interface used for passing explicit user
              credentials to the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Repository.html#login(javax.jcr.Credentials)"
                 class="externalLink" title="javax.jcr.Repository.login(Credentials)"
                >Repository.login(Credentials)</a> method.
            </p>
            <p>
              The
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Node.html"
                 class="externalLink" title="javax.jcr.Node"
                >Node</a> interface is used to manage the content nodes in
              a repository. There is a related interface called
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Property.html"
                 class="externalLink" title="javax.jcr.Property"
                >Property</a> for managing content properties, but in this
              example we use the Property interface only indirectly.
            </p>
          </dd>

          <dt><code><strong>new</strong> SimpleCredentials("<em>username</em>", "<em>password</em>".toCharArray())</code></dt>
          <dd>
            <p>
              As discussed in the First Hop example, the default
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Repository.html#login()"
                 class="externalLink" title="javax.jcr.Repository.login()"
                >Repository.login()</a> method returns an anonymous read-only
              session in the Jackrabbit default configuration. To be able to
              store and remove content we need to create a session with
              write access, and to do that we need to pass some credentials
              to the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Repository.html#login(javax.jcr.Credentials)"
                 class="externalLink" title="javax.jcr.Repository.login(javax.jcr.Credentials)"
                >Repository.login(Credentials credentials)</a> method.
            </p>
            <p>
              The default Jackrabbit login mechanism accepts any username and
              password as valid credentials and returns a session with full
              write access. Thus we only need to construct and use a
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/SimpleCredentials.html"
                 class="externalLink" title="javax.jcr.SimpleCredentials"
                >SimpleCredentials</a> instance with some dummy username and
              password, in this case <code>"username"</code> and
              <code>"password"</code>.
            </p>
            <p>
              The SimpleCredentials constructor follows the JAAS convention
              of represenenting the username as a normal String, but the
              password as a character array, so we need to use the
              <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html#toCharArray()"
                 class="externalLink" title="java.lang.String.toCharArray()"
               >String.toCharArray()</a> method to satisfy the constructor.
            </p>
          </dd>

          <dt><code>Node root = session.getRootNode();</code></dt>
          <dd>
            <p>
              Each JCR session is associated with a workspace that contains
              a single node tree. A simple way to access the root node is to
              call the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Session.html#getRootNode()"
                 class="externalLink" title="javax.jcr.Session.getRootNode()"
                >Session.getRootNode()</a> method. Having a reference to the
              root node allows us to easily store and retrieve content in the
              current workspace.
            </p>
          </dd>

          <dt><code>Node hello = root.addNode("hello");</code></dt>
          <dt><code>Node world = hello.addNode("world");</code></dt>
          <dd>
            <p>
              New content nodes can be added using the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Node.html#addNode(java.lang.String)"
                 class="externalLink" title="javax.jcr.Node.addNode(String)"
                >Node.addNode(String relPath)</a> method. The method takes the
              name (or relative path) of the node to be added and creates the
              named node in the transient storage associated with the current
              session. Until the transient storage is persisted, the added node
              is only visible within the current session and not within any
              other session that is concurrently accessing the content
              repository.
            </p>
            <p>
              This code snippet creates two new nodes, called "hello" and
              "world", with "hello" being a child of the root node and "world"
              a child of the "hello" node.
            </p>
          </dd>
            
          <dt><code>world.setProperty("message", "Hello, World!");</code></dt>
          <dd>
            <p>
              To add some content to the structure created using the "hello"
              and "world" nodes, we use the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Node.html#setProperty(java.lang.String,%20java.lang.String)"
                 class="externalLink" title="javax.jcr.Node.setProperty(String, String)"
                >Node.setProperty(String name, String value)</a> method to
              add a string property called "message" to the "world" node. The
              value of the property is the string "Hello, World!".
            </p>
            <p>
              Like the added nodes, also the property is first created in the
              transient storage associated with the current session. If the
              named property already exists, then this method will change
              the value of that property.
            </p>
          </dd>

          <dt><code>session.save();</code></dt>
          <dd>
            <p>
              Even though the rest of our example would work just fine using
              only the transient storage of the single session, we'd like
              to persist the changes we've made so far. This way other sessions
              could also access the example content we just created. If you
              like, you could even split the example application into three
              pieces for respectively storing, retrieving, and removing the
              example content. Such a split would not work unless we persisted
              the changes we make.
            </p>
            <p>
              The
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Session.html#save()"
                 class="externalLink" title="javax.jcr.Session.save()"
                >Session.save()</a> method persists all pending changes in the
              transient storage. The changes are written to the persistent
              repository storage and they become visible to all sessions
              accessing the same workspace. Without this call all changes
              will be lost forever when the session is closed.
            </p>
          </dd>

          <dt><code>Node node = root.getNode("hello/world");</code></dt>
          <dd>
            <p>
              Since we are still using the same session, we could use the
              existing <code>hello</code> and <code>world</code> node
              references to access the stored content, but let's pretend
              that we've started another session and want to retrieve the
              content that was previously stored.
            </p>
            <p>
              The
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Node.html#getNode(java.lang.String)"
                 class="externalLink" title="javax.jcr.Node.getNode(String)"
                >Node.getNode(String relPath)</a> method returns a reference
              to the node at the given path relative to this node. The path
              syntax follows common file system conventions: a forward slash
              separates node names, a single dot represents the current node,
              and a double dot the parent node. Thus the path "hello/world"
              identifies the "world" child node of the "hello" child node
              of the current node - in this case the root node. The end result
              is that the method returns a node instance that represents the
              same content node as the <code>world</code> instance created
              a few lines earlier.
            </p>
          </dd>

          <dt><code>System.out.println(node.getPath());</code></dt>
          <dd>
            <p>
              Each content node and property is uniquely identified by its
              absolute path within the workspace. The absolute path starts
              with a forward slash and contains all the names of the
              ancestor nodes in order before the name of the current
              node or property.
            </p>
            <p>
              The path of a node or property can be retrieved using the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Item.html#getPath()"
                 class="externalLink" title="javax.jcr.Item.getPath()"
                >Item.getPath()</a> method. The
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Item.html"
                 class="externalLink" title="javax.jcr.Item"
                >Item</a> inteface is a superinterface of Node and Property,
              and contains all the functionality shared by nodes and properties.
            </p>
            <p>
              The <code>node</code> variable references the "world" node, so
              this statement will output the line "/hello/world".
            </p>
          </dd>

          <dt><code>System.out.println(node.getProperty("message").getString());</code></dt>
          <dd>
            <p>
              Properties can be accessed using the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Node.html#getProperty(java.lang.String)"
                 class="externalLink" title="javax.jcr.Node.getProperty(String)"
                >Node.getProperty(String relPath)</a> method that returns an
              instance of the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Property.html"
                 class="externalLink" title="javax.jcr.Property"
                >Property</a> interface that represents the property at the
              given path relative to the current node. In this case the
              "message" property is the one we created a few lines earlier.
            </p>
            <p>
              A JCR property can contain either a single or multiple values
              of a given type. There are property types for storing strings,
              numbers, dates, binary streams, node references, etc. We just
              want the single string value, so we use the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Property.html#getString()"
                 class="externalLink" title="javax.jcr.Property.getString()"
                >Property.getString()</a> method. The result of this statement
              is the line "Hello, World!" being outputted.
            </p>
          </dd>

          <dt><code>root.getNode("hello").remove();</code></dt>
          <dd>
            <p>
              Nodes and properties can be removed using the
              <a href="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/Item.html#remove()"
                 class="externalLink" title="javax.jcr.Item.remove()"
                >Item.remove()</a> method. The method removes the entire
              content subtree, so we only need to remove the topmost "hello"
              node to get rid of all the content we added before.
            </p>
            <p>
              Removals are first stored in the session-local transient
              storage, just like added and changed content. Like before,
              the transient changes need to be explicitly saved for the
              content to be removed from the persistent storage.
            </p>
          </dd>
        </dl>
      </subsection>

  <subsection name="Hop 3: Importing content">
        <p>TODO: Update to match the style of previous hops.</p>
   <p>
    To add content a bit more efficiently, you may want to try
    JCR's import facilities, such as <code>Session.importXML</code>.
    The following <a href="http://www.cafeconleche.org/slides/xmlone/london2002/namespaces/10.html">XML document by Elliotte Rusty Harold</a>
    provides an interesting example that demonstrates a repository's
    namespace capabilities:
   </p>
   <p><strong>test.xml</strong></p>
<!--  Copyright 2001, 2002 Elliotte Rusty Harold -->
<source><![CDATA[<xhtml:html xmlns:xhtml="http://www.w3.org/1999/xhtml"
            xmlns:mathml="http://www.w3.org/1998/Math/MathML">
  <xhtml:head><xhtml:title>Three Namespaces</xhtml:title></xhtml:head>
  <xhtml:body>
    <xhtml:h1 align="center">An Ellipse and a Rectangle</xhtml:h1>
    <svg:svg xmlns:svg="http://www.w3.org/2000/svg" 
             width="12cm" height="10cm">
      <svg:ellipse rx="110" ry="130" />
      <svg:rect x="4cm" y="1cm" width="3cm" height="6cm" />
    </svg:svg>
    <xhtml:p>The equation for ellipses</xhtml:p>
<mathml:math>
  <mathml:apply>
    <mathml:eq/>
    <mathml:cn> 1 </mathml:cn>
    <mathml:apply>
      <mathml:plus/>
      <mathml:apply>
        <mathml:divide/>
        <mathml:apply>
          <mathml:power/>
          <mathml:ci> x </mathml:ci>
          <mathml:cn> 2 </mathml:cn>
        </mathml:apply>
        <mathml:apply>
          <mathml:power/>
          <mathml:ci> a </mathml:ci>
          <mathml:cn> 2 </mathml:cn>
        </mathml:apply>
      </mathml:apply>
      <mathml:apply>
        <mathml:divide/>
        <mathml:apply>
          <mathml:power/>
          <mathml:ci> y </mathml:ci>
          <mathml:cn> 2 </mathml:cn>
        </mathml:apply>
        <mathml:apply>
          <mathml:power/>
          <mathml:ci> b </mathml:ci>
          <mathml:cn> 2 </mathml:cn>
        </mathml:apply>        
      </mathml:apply>
    </mathml:apply>
 </mathml:apply>
</mathml:math>
    <xhtml:hr/>
    <xhtml:p>Last Modified January 10, 2002</xhtml:p>    
  </xhtml:body>
</xhtml:html>]]></source>
   <p>
    The third example application shown below will import the XML file called
    <code>test.xml</code> from the current directory into a new content
    repository node called <code>importxml</code>. Once the XML content is
    imported, the application recursively dumps the contents of the entire
    workspace using the simple <code>dump()</code> method.
   </p>
   <p><strong>ThirdHop.java</strong></p>
<source>import javax.jcr.*;
import org.apache.jackrabbit.core.TransientRepository;
import java.io.FileInputStream;

/**
 * <i>Third Jackrabbit example application. Imports an example XML file</i>
 * <i>and outputs the contents of the entire workspace.</i>
 */
public class ThirdHop {

    /** <i>Runs the ThirdHop example.</i> */
    public static void main(String[] args) throws Exception {
        // <i>Set up a Jackrabbit repository with the specified</i>
        // <i>configuration file and repository directory</i>
        Repository repository = new TransientRepository();

        // <i>Login to the default workspace as a dummy user</i>
        Session session = repository.login(
            new SimpleCredentials("username", "password".toCharArray()));
        try {
            // <i>Use the root node as a starting point</i>
            Node root = session.getRootNode();

            // <i>Import the XML file unless already imported</i>
            if (!root.hasNode("importxml")) {
                System.out.print("Importing xml... ");
                // <i>Create an unstructured node under which to import the XML</i>
                Node node = root.addNode("importxml", "nt:unstructured");
                // <i>Import the file "test.xml" under the created node</i>
                FileInputStream xml = new FileInputStream("<b>test.xml</b>");
                session.importXML(
                    "/importxml", xml, ImportUUIDBehavior.IMPORT_UUID_CREATE_NEW);
                xml.close();
                // <i>Save the changes to the repository</i>
                session.save();
                System.out.println("done.");
            }

            dump(root);
        } finally {
            session.logout();
        }
    }

    /** <i>Recursively outputs the contents of the given node.</i> */
    private static void dump(Node node) throws RepositoryException {
        // <i>First output the node path</i>
        System.out.println(node.getPath());
        // <i>Skip the virtual (and large!) jcr:system subtree</i>
        if (node.getName().equals("jcr:system")) {
            return;
        }

        // <i>Then output the properties</i>
        PropertyIterator properties = node.getProperties();
        while (properties.hasNext()) {
            Property property = properties.nextProperty();
            if (property.getDefinition().isMultiple()) {
                // <i>A multi-valued property, print all values</i>
                Value[] values = property.getValues();
                for (int i = 0; i &lt; values.length; i++) {
                    System.out.println(
                        property.getPath() + " = " + values[i].getString());
                }
            } else {
                // <i>A single-valued property</i>
                System.out.println(
                    property.getPath() + " = " + property.getString());
            }
        }

        // <i>Finally output all the child nodes recursively</i>
        NodeIterator nodes = node.getNodes();
        while (nodes.hasNext()) {
            dump(nodes.nextNode());
        }
    }

}
</source>
    <p>
      Running the ThirdHop class should produce output like the following:
    </p>
<source>Importing XML... done.
/
/jcr:primaryType=rep:root
/jcr:system
/testnode
/testnode/jcr:primaryType=nt:unstructured
/testnode/testprop=Hello, World.
/importxml
/importxml/jcr:primaryType=nt:unstructured
/importxml/xhtml:html
/importxml/xhtml:html/jcr:primaryType=nt:unstructured
/importxml/xhtml:html/xhtml:head
/importxml/xhtml:html/xhtml:head/jcr:primaryType=nt:unstructured
/importxml/xhtml:html/xhtml:head/xhtml:title
/importxml/xhtml:html/xhtml:head/xhtml:title/jcr:primaryType=nt:unstructured
/importxml/xhtml:html/xhtml:head/xhtml:title/jcr:xmltext
/importxml/xhtml:html/xhtml:head/xhtml:title/jcr:xmltext/jcr:primaryType=nt:unstructured
/importxml/xhtml:html/xhtml:head/xhtml:title/jcr:xmltext/jcr:xmlcharacters=Three Namespaces
/importxml/xhtml:html/xhtml:body
/importxml/xhtml:html/xhtml:body/jcr:primaryType=nt:unstructured
/importxml/xhtml:html/xhtml:body/xhtml:h1
/importxml/xhtml:html/xhtml:body/xhtml:h1/jcr:primaryType=nt:unstructured
/importxml/xhtml:html/xhtml:body/xhtml:h1/align=center
/importxml/xhtml:html/xhtml:body/xhtml:h1/jcr:xmltext
/importxml/xhtml:html/xhtml:body/xhtml:h1/jcr:xmltext/jcr:primaryType=nt:unstructured
/importxml/xhtml:html/xhtml:body/xhtml:h1/jcr:xmltext/jcr:xmlcharacters=An Ellipse and a Rectangle
/importxml/xhtml:html/xhtml:body/svg:svg
/importxml/xhtml:html/xhtml:body/svg:svg/jcr:primaryType=nt:unstructured
/importxml/xhtml:html/xhtml:body/svg:svg/width=12cm
/importxml/xhtml:html/xhtml:body/svg:svg/height=10cm
.
.
.</source>
  </subsection>
  </section>
 </body>
</document>
