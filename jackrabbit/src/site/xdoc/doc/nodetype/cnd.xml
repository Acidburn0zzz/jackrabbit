<?xml version="1.0"?>
<!--
   Copyright 2004-2005 The Apache Software Foundation or its licensors,
                       as applicable.

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
  -->
<document>
    <properties>
        <title>CND Notation</title>
    </properties>
    <body>
        <section name="Introduction">
            <p>
                The Compact Namespace and Node Type Definition (CND) notation provides a compact 
                standardized syntax for defining node types and making namespace declarations. 
                The notation is intended both for documentation and for programmatically registering 
                node types (if you are unfamiliar with JCR node types, you may want to read the 
                <a href="index.html">general Node Types section</a> first).
            </p>
            <p>
                Here is a "worst-case scenario" example that demonstrates all the features of the notation:
            </p>
<source><![CDATA[/*  An example node type definition */

// The namespace declaration
<ns = 'http://namespace.com/ns'>

// Node type name
[ns:NodeType]

// Supertypes
> ns:ParentType1, ns:ParentType2

// This node type supports orderable child nodes
orderable

// This is a mixin node type
mixin

// A property called 'ex:property' of type STRING
- ex:property (string)

// The default values for this
// (multi-value) property are...
= 'default1', 'default2'

// This property is the primary item
primary

// and it is...
mandatory autocreated protected

// and multi-valued
multiple

// It has an on-parent-version setting of ...
version

// The constraint settings are...
< 'constraint1', 'constraint2'

// A child node called ns:node which must be of
// at least the node types ns:reqType1 and ns:reqType2
+ ns:node (ns:reqType1, ns:reqType2)

// with default primary node type is...
= ns:defaultType

// This node is...
mandatory autocreated protected

// supports same name siblings
multiple

// and has an on-parent-version setting of ...
version]]></source>
            <p>
                This definition can be written more compactly and with indentation:
            </p>
<source><![CDATA[/*  An example node type definition */
<ns = 'http://namespace.com/ns'>
[ns:NodeType] > ns:ParentType1, ns:ParentType2
  orderable mixin
  - ex:property (string)
= 'default1', 'default2'
    primary mandatory autocreated protected multiple
    version
    < 'constraint1', 'constraint2'
  + ns:node (ns:reqType1, ns:reqType2)
    = ns:defaultType
    mandatory autocreated protected multiple version]]></source>
            <p>
               or, using short forms for the attributes, even like this:
            </p>
<source><![CDATA[<ns='http://namespace.com/ns'>
[ns:NodeType]>ns:ParentType1, ns:ParentType2 o m
-ex:property='default1','default2' ! m a p * version
 <'constraint1', 'constraint2'
+ns:node(ns:reqType1,ns:reqType2)=ns:defaultType
 m a p *  version]]></source>
        </section>
        <section name="Grammar">
            <p>
                The following grammar defines the CND notation. Terminal symbols are bold and in double quotes.
            </p>
<source><![CDATA[cnd ::= {ns_mapping | node_type_def}

ns_mapping ::= "<" prefix "=" uri ">"

prefix ::= string

uri ::= string

node_type_def ::= node_type_name [supertypes] [options]
                  {property_def | child_node_def}

node_type_name ::= "[" string "]"

supertypes ::= ">" string_list

options ::= orderable_opt | mixin_opt | orderable_opt
            mixin_opt | mixin_opt orderable_opt

orderable_opt ::= "orderable" | "ord" | "o"

mixin_opt ::= "mixin" | "mix" | "m"

property_def ::= "-" property_name [property_type_decl]
                 [default_values] [attributes]
                 [value_constraints]

property_name ::= string

property_type_decl ::= "(" property_type ")"

property_type ::= "STRING" | "String" |"string" |
                  "BINARY" | "Binary" | "binary" |
                  "LONG" | "Long" | "long" |
                  "DOUBLE" | "Double" | "double" |
                  "BOOLEAN" | "Boolean" | "boolean" |
                  "DATE" | "Date" | "date" |
                  "NAME | "Name | "name |
                  "PATH" | "Path" | "path" |
                  "REFERENCE" | "Reference" |
                     "reference" |
                  "UNDEFINED" | "Undefined" |
                     "undefined" | "*"

default_values ::= "=" string_list

value_constraints ::= "<" string_list

node_def ::= "+" node_name [required_types]
             [default_type] [attributes]

node_name ::= string

required_types ::= "(" string_list ")"

default_type ::= "=" string

attributes ::= "primary" | "pri" | "!" |
               "autocreated" | "aut" | "a" |
               "mandatory" | "man" | "m" |
               "protected" | "pro" | "p" |
               "multiple" | "mul" | "*" |
               "COPY" | "Copy" | "copy" |
               "VERSION" | "Version" | "version" |
               "INITIALIZE" | "Initialize" |
                  "initialize" |
               "COMPUTE" | "Compute" | "compute" |
               "IGNORE" | "Ignore" | "ignore" |
               "ABORT" | "Abort" | "abort"

string_list ::= string {"," string}

string ::= quoted_string | unquoted_string

quoted_string :: = "'" unquoted_string "'"

unquoted_string ::= /* a string */]]></source>
        </section>
        <section name = "Comparison of Notations">
            <subsection name = "Old Documentation Notation">
                <p>
                    Here is the definition of the built-in node type nt:resource using 
                    the old documentation notation (used in v1.0 of the JCR specification, 
                    for example):
                </p>
<source><![CDATA[NodeTypeName
  nt:resource
Supertypes
  nt:base
  mix:referenceable
IsMixin
  false
HasOrderableChildNodes
  false
PrimaryItemName
  jcr:data
PropertyDefinition
  Name jcr:encoding
  RequiredType STRING
  ValueConstraints []
  DefaultValues null
  AutoCreated false
  Mandatory false
  OnParentVersion COPY
  Protected false
  Multiple false
PropertyDefinition
  Name jcr:mimeType
  RequiredType STRING
  ValueConstraints []
  DefaultValues null
  AutoCreated false
  Mandatory true
  OnParentVersion COPY
  Protected false
  Multiple false
PropertyDefinition
  Name jcr:data
  RequiredType BINARY
  ValueConstraints []
  DefaultValues null
  AutoCreated false
  Mandatory true
  OnParentVersion COPY
  Protected false
  Multiple false
PropertyDefinition
  Name jcr:lastModified
  RequiredType DATE
  ValueConstraints []
  DefaultValues null
  AutoCreated false
  Mandatory true
  OnParentVersion IGNORE
  Protected false
  Multiple false]]></source>   
            </subsection>
            <subsection name="Old Configuration Notation">
                <p>
                    Here is the same node type in the standard XML notation 
                    (used in configuration files in the Jackrabbit project, 
                    for example):
                </p>
<source><![CDATA[<nodeType name="nt:resource"
          isMixin="false"
          hasOrderableChildNodes="false"
          primaryItemName="jcr:data">
    <supertypes>
        <supertype>nt:base</supertype>
        <supertype>mix:referenceable</supertype>
    </supertypes>
    <propertyDefinition name="jcr:encoding"
                        requiredType="String"
                        autoCreated="false"
                        mandatory="false"
                        onParentVersion="COPY"
                        protected="false"
                        multiple="false"/>
    <propertyDefinition name="jcr:mimeType"
                        requiredType="String"
                        autoCreated="false"
                        mandatory="true"
                        onParentVersion="COPY"
                        protected="false"
                        multiple="false"/>
    <propertyDefinition name="jcr:data"
                        requiredType="Binary"
                        autoCreated="false"
                        mandatory="true"
                        onParentVersion="COPY"
                        protected="false"
                        multiple="false"/>
    <propertyDefinition name="jcr:lastModified"
                        requiredType="Date"
                        autoCreated="false"
                        mandatory="true"
                        onParentVersion="IGNORE"
                        protected="false"
                        multiple="false"/>
</nodeType>]]></source>
            </subsection>
            <subsection name="New Format">
                <p>
                    And, here it is in the new CND notation:
                </p>
<source><![CDATA[[nt:resource] > mix:referencable
- jcr:encoding
- jcr:mimeType mandatory
- jcr:data (binary) mandatory
- jcr:lastModified (date) mandatory ignore]]></source>
            </subsection>
        </section>
    </body>
</document>